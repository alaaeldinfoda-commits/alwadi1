{% extends 'base.html' %}
{% block content %}

<div class="fade-in-up">

  <!-- HEADER CARD -->
  <div class="card shadow-sm border-0 mb-4 report-header">
    <div class="card-body d-flex justify-content-between align-items-start flex-wrap">

      <div>
        <h3 class="fw-bold mb-1">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø±Ù‚Ù… #{{ report.report_id }}</h3>
        <p class="text-muted mb-2">{{ report.date_created }}</p>

        <div class="small">
          <div><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong> {{ report.site_name }}</div>
          <div><strong>Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„:</strong> {{ report.contractor_name or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</div>
          <div><strong>Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³:</strong> {{ report.engineer_name }}</div>
        </div>

        <!-- GPS -->
        <div class="mt-2 small gps-box p-2 rounded">
          <strong>GPS:</strong> {{ report.gps_lat }} , {{ report.gps_lon }}
          <a class="btn btn-sm btn-primary ms-2"
             href="https://www.google.com/maps?q={{ report.gps_lat }},{{ report.gps_lon }}"
             target="_blank">
            Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
          </a>
        </div>
      </div>

      <div class="mt-3 mt-md-0">
        <a class="btn btn-success shadow-sm px-4" href="/report/{{ report.report_id }}/pdf">ğŸ“„ ØªØµØ¯ÙŠØ± PDF</a>
      </div>

    </div>
  </div>

  <!-- DESCRIPTION -->
  <div class="card shadow-sm border-0 mb-4 fade-in-up">
    <div class="card-header bg-primary text-white">
      <strong>Ø§Ù„ÙˆØµÙ</strong>
    </div>
    <div class="card-body">
      <p class="text-dark">{{ report.description or 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ' }}</p>
    </div>
  </div>

  <!-- WORKERS -->
  <div class="card shadow-sm border-0 mb-4 fade-in-up">
    <div class="card-header bg-secondary text-white">
      <strong>Ø§Ù„Ø¹Ù…Ø§Ù„Ø©</strong>
    </div>

    <div class="card-body p-0">
      {% if workers %}
      <div class="table-responsive">
        <table class="table table-striped mb-0">
          <thead class="table-light">
            <tr>
              <th>Ø§Ù„Ø§Ø³Ù…</th>
              <th>Ø§Ù„ÙˆØ¸ÙŠÙØ©</th>
              <th>Ø§Ù„Ù…Ù‡Ù…Ø©</th>
              <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
            </tr>
          </thead>
          <tbody>
            {% for w in workers %}
            <tr>
              <td>{{ w.worker_name }}</td>
              <td>{{ w.job_title }}</td>
              <td>{{ w.task_details }}</td>
              <td>{{ w.notes }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-muted p-3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù…Ø§Ù„Ø©.</p>
      {% endif %}
    </div>
  </div>

  <!-- IMAGES -->
  <div class="card shadow-sm border-0 fade-in-up">
    <div class="card-header bg-dark text-white">
      <strong>Ø§Ù„ØµÙˆØ±</strong>
    </div>

    <div class="card-body">
      <div class="row g-3">

        {% for img in images %}
        <div class="col-6 col-md-3">
          <div class="img-card shadow-sm rounded overflow-hidden hover-zoom" onclick="openLightbox('/uploads/{{ img.image_path }}')">
            <img src="/uploads/{{ img.image_path }}" class="w-100" style="height:170px; object-fit:cover;">
          </div>
        </div>
        {% endfor %}

      </div>

      {% if not images %}
      <p class="text-muted mt-2">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± Ù…Ø±ÙÙ‚Ø© Ø¨Ø§Ù„ØªÙ‚Ø±ÙŠØ±.</p>
      {% endif %}
    </div>
  </div>

</div>

<!-- LIGHTBOX VIEWER -->
<div id="lightbox" class="lightbox d-none" onclick="closeLightbox()">
  <img id="lightbox-img">
</div>

<style>
/************** Header styling **************/
.report-header {
  border-right: 4px solid var(--bs-primary);
}

/************** GPS **************/
.gps-box {
  background: rgba(13,110,253,0.08);
  border-right: 3px solid var(--bs-primary);
}

/************** Image hover **************/
.hover-zoom img {
  transition: .3s ease;
}
.hover-zoom:hover img {
  transform: scale(1.08);
}

/************** Lightbox **************/
.lightbox {
  position: fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background: rgba(0,0,0,0.85);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.lightbox img {
  max-width:90%;
  max-height:90%;
  border-radius:10px;
  box-shadow:0 0 20px rgba(255,255,255,0.2);
}
.lightbox.d-none { display:none !important; }

/************** Animations **************/
.fade-in-up {
  animation: fadeInUp .6s ease;
}
@keyframes fadeInUp {
  from {opacity:0; transform: translateY(20px);}
  to {opacity:1; transform: translateY(0);}
}
</style>

<script>
/**************** LIGHTBOX SCRIPT ****************/
function openLightbox(src) {
  document.getElementById("lightbox-img").src = src;
  document.getElementById("lightbox").classList.remove("d-none");
}
function closeLightbox() {
  document.getElementById("lightbox").classList.add("d-none");
}
</script>

{% endblock %}
