{% extends "base.html" %}
{% block content %}

<div class="fade-in-up">

  <!-- HEADER + BACK -->
  <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
    <h3 class="fw-bold">
      {% if site %} âœ ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆÙ‚Ø¹ {% else %} â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ‚Ø¹ Ø¬Ø¯ÙŠØ¯ {% endif %}
    </h3>

    <a href="/sites" class="btn btn-outline-secondary shadow-sm hover-up px-4">
      â¬… Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙˆØ§Ù‚Ø¹
    </a>
  </div>

  <!-- FORM CARD -->
  <div class="card shadow-sm border-0 p-4">

    <form method="POST" class="row g-3">

      <!-- Site Code -->
      <div class="col-md-6">
        <label class="form-label fw-bold">ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
        <input type="text"
               name="site_code"
               class="form-control form-control-lg input-animate"
               value="{{ site.site_code if site }}"
               required>
      </div>

      <!-- Site Name -->
      <div class="col-md-6">
        <label class="form-label fw-bold">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
        <input type="text"
               name="site_name"
               class="form-control form-control-lg input-animate"
               value="{{ site.site_name if site }}"
               required>
      </div>

      <!-- Address -->
      <div class="col-md-12">
        <label class="form-label fw-bold">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
        <input type="text"
               name="address"
               class="form-control form-control-lg input-animate"
               value="{{ site.address if site }}">
      </div>

      <!-- Latitude + Longitude -->
      <div class="col-md-6">
        <label class="form-label fw-bold">Latitude</label>
        <input type="text"
               name="latitude"
               id="lat"
               class="form-control form-control-lg input-animate"
               value="{{ site.latitude if site }}">
      </div>

      <div class="col-md-6">
        <label class="form-label fw-bold">Longitude</label>
        <input type="text"
               name="longitude"
               id="lon"
               class="form-control form-control-lg input-animate"
               value="{{ site.longitude if site }}">
      </div>

      <!-- Button: Auto location -->
      <div class="col-md-12">
        <button type="button"
                class="btn btn-info px-4 shadow-sm hover-scale"
                onclick="autoGPS()">
          ğŸ“ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
        </button>
        <small id="gpsStatus" class="ms-2 text-muted"></small>
      </div>

      <!-- Contractor -->
      <div class="col-md-12">
        <label class="form-label fw-bold">Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„</label>
        <select name="contractor_id"
                class="form-select form-select-lg input-animate">
          <option value="">-- Ø¨Ø¯ÙˆÙ† --</option>
          {% for c in contractors %}
          <option value="{{ c.contractor_id }}"
            {% if site and site.contractor_id == c.contractor_id %} selected {% endif %}>
            {{ c.contractor_name }}
          </option>
          {% endfor %}
        </select>
      </div>

      <!-- SUBMIT -->
      <div class="col-12 text-end mt-4">
        <button class="btn btn-primary btn-lg hover-scale px-5">
          ğŸ’¾ Ø­ÙØ¸
        </button>
      </div>

    </form>
  </div>
</div>

<!-- ===================== STYLES ===================== -->
<style>
.fade-in-up { animation: fadeInUp .6s ease; }
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}

.input-animate {
  transition: 0.25s ease;
}
.input-animate:focus {
  transform: scale(1.03);
  border-color: var(--bs-primary);
  box-shadow: 0 0 8px rgba(13,110,253,0.3);
}

.hover-scale {
  transition: .25s ease;
}
.hover-scale:hover {
  transform: scale(1.05);
}

.hover-up {
  transition: .25s ease;
}
.hover-up:hover {
  transform: translateY(-4px);
}
</style>

<!-- ===================== SCRIPT ===================== -->
<script>
function autoGPS() {
  const status = document.getElementById("gpsStatus");
  status.innerText = "Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...";

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      pos => {
        document.getElementById("lat").value = pos.coords.latitude;
        document.getElementById("lon").value = pos.coords.longitude;

        status.innerText = "âœ” ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­";
        status.style.color = "green";
      },
      err => {
        status.innerText = "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… GPS";
        status.style.color = "red";
      }
    );
  } else {
    status.innerText = "âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… GPS";
    status.style.color = "red";
  }
}
</script>

{% endblock %}
